install.packages("~/Downloads/oro.dicom_0.4.1.tar.gz", repos = NULL, type = "source")
x = readLines("Rdcm2nii.R")
x
x = gsub('.*-.*', "", x)
x
x = readLines("Rdcm2nii.R")
x = gsub('\\s-(.*)', "\\1", x)
x
x = gsub('^-(.*)', "\\1", x)
x
writeLines(x, "Rdcm2nii.R")
Rdcm2nii <- function(basedir, sortdir, verbose=TRUE, ...){
gf <- getfiles(basedir)
files <- gf$files
paths <- gf$paths
## THEN PIPELINE TEST
ipath <- 1
lpath <- length(paths)
### need dcm2nii in your path! - from MRICRON
if (lpath >= 1){
if (verbose) cat("Converting to nii using R \n")
for (ipath in 1:length(paths)){
path <- paths[ipath]
res <- system(sprintf('rm "%s"/*.nii.gz', path), ignore.stdout = !verbose)
dcm2nii_worker(path)
niis <- dir(path=path, pattern=".nii.gz")
stub <- basename(path)
iddir <- file.path(basedir)
name <- stub
### copy dicom header info
make_txt(path)
if (length(niis) > 1){
# stop("it")
# cmd <- 'FSLDIR=/usr/local/fsl; FSLOUTPUTTYPE=NIFTI_GZ; export FSLDIR FSLOUTPUTTYPE; '
# cmd <- paste0(cmd, 'echo $FSLDIR; sh ${FSLDIR}/etc/fslconf/fsl.sh; ',
#   '/usr/local/fsl/bin/fslmerge -z "%s"/"%s".nii.gz "%s"/*.nii.gz')
cmd <- c('fslmerge -z "%s"/"%s".nii.gz "%s"/*.nii.gz')
system(sprintf(cmd, iddir, name, path), ignore.stdout = !verbose)
}
if (length(niis) == 1){
system(sprintf('mv "%s"/*.nii.gz "%s"/"%s".nii.gz', path, iddir, name),
ignore.stdout = !verbose)
}
system(sprintf('rm "%s"/*.nii.gz', path), ignore.stdout = !verbose)
setwd(dirname(path))
#     stop("me")
newpath <- file.path(dirname(path), name)
system(sprintf('mv "%s" "%s"', path, newpath), ignore.stdout = !verbose)
# setwd(basename(newpath))
# tarfile <- paste(newpath, ".tar.gz", sep="")
# tar(tarfile, compression="gzip")
system(sprintf('tar -czf "%s" ./"%s"', paste(newpath, ".tar.gz", sep=""),
basename(newpath)), ignore.stdout = !verbose)
system(sprintf('rm -R "%s"', newpath), ignore.stdout = !verbose)
}
} # end loop over paths
} ## end Rdcm2nii
###################
#### read in baseline NIHSS so that we can cross ref with Image
####
options(stringsAsFactors=FALSE)
rootdir = "~/Dropbox/CTR/DHanley/MISTIE"
rootdir = path.expand(rootdir)
homedir = file.path(rootdir, "MISTIE DSMB Analysis")
datadir = file.path(homedir, "statadata")
nihss = read.csv(file.path(datadir, "baseline_NIHSS.csv"),
na.strings = c("NA", ".", ""))
nihss
head(nihss)
hist(nihss$nihss_total)
range(nihss$nihss_total)
range(nihss$nihss_total, na.rm=TRUE
)
###################
#### read in baseline NIHSS so that we can cross ref with Image
####
options(stringsAsFactors=FALSE)
rootdir = "~/CT_Registration"
rootdir = path.expand(rootdir)
progdir = file.path(rootdir, "programs")
datadir = file.path(homedir, "data")
nihss = read.csv(file.path(datadir, "baseline_NIHSS.csv"),
na.strings = c("NA", ".", ""))
load(file.path(datadir, Registration_Image_Names.Rda))
###################
#### read in baseline NIHSS so that we can cross ref with Image
####
options(stringsAsFactors=FALSE)
rootdir = "~/CT_Registration"
rootdir = path.expand(rootdir)
progdir = file.path(rootdir, "programs")
datadir = file.path(homedir, "data")
nihss = read.csv(file.path(datadir, "baseline_NIHSS.csv"),
na.strings = c("NA", ".", ""))
###################
#### read in baseline NIHSS so that we can cross ref with Image
####
options(stringsAsFactors=FALSE)
rootdir = "~/CT_Registration"
rootdir = path.expand(rootdir)
progdir = file.path(rootdir, "programs")
datadir = file.path(rootdir, "data")
nihss = read.csv(file.path(datadir, "baseline_NIHSS.csv"),
na.strings = c("NA", ".", ""))
load(file.path(datadir, Registration_Image_Names.Rda))
###################
#### read in baseline NIHSS so that we can cross ref with Image
####
options(stringsAsFactors=FALSE)
rootdir = "~/CT_Registration"
rootdir = path.expand(rootdir)
progdir = file.path(rootdir, "programs")
datadir = file.path(rootdir, "data")
nihss = read.csv(file.path(datadir, "baseline_NIHSS.csv"),
na.strings = c("NA", ".", ""))
load(file.path(datadir, "Registration_Image_Names.Rda"))
df
df$id
###################
#### read in baseline NIHSS so that we can cross ref with Image
####
options(stringsAsFactors=FALSE)
rootdir = "~/CT_Registration"
rootdir = path.expand(rootdir)
progdir = file.path(rootdir, "programs")
datadir = file.path(rootdir, "data")
nihss = read.csv(file.path(datadir, "baseline_NIHSS.csv"),
na.strings = c("NA", ".", ""))
load(file.path(datadir, "Registration_Image_Names.Rda"))
dat = merge(df, nihss, all.x = TRUE)
head(dat)
###################
#### read in baseline NIHSS so that we can cross ref with Image
####
options(stringsAsFactors=FALSE)
rootdir = "~/CT_Registration"
rootdir = path.expand(rootdir)
progdir = file.path(rootdir, "programs")
datadir = file.path(rootdir, "data")
nihss = read.csv(file.path(datadir, "baseline_NIHSS.csv"),
na.strings = c("NA", ".", ""))
load(file.path(datadir, "Registration_Image_Names.Rda"))
###################
#### read in baseline NIHSS so that we can cross ref with Image
####
options(stringsAsFactors=FALSE)
rootdir = "~/CT_Registration"
rootdir = path.expand(rootdir)
progdir = file.path(rootdir, "programs")
datadir = file.path(rootdir, "data")
nihss = read.csv(file.path(datadir, "baseline_NIHSS.csv"),
na.strings = c("NA", ".", ""))
load(file.path(datadir, "Registration_Image_Names.Rda"))
ids = df$id
ids
nihss$patientName
###################
#### read in baseline NIHSS so that we can cross ref with Image
####
options(stringsAsFactors=FALSE)
rootdir = "~/CT_Registration"
rootdir = path.expand(rootdir)
progdir = file.path(rootdir, "programs")
datadir = file.path(rootdir, "data")
nihss = read.csv(file.path(datadir, "baseline_NIHSS.csv"),
na.strings = c("NA", ".", ""))
load(file.path(datadir, "Registration_Image_Names.Rda"))
ids = df$id
ids = as.numeric(gsub("-", "", ids))
nihss = nihss[ nihss$patientName %in% ids, ]
hist(nihss$nihss_total)
range(nihss$nihss_total)
range(nihss$nihss_total, na.rm=TRUE)
nrow(nihss)
